---
title: "Week 9 Midterm Replacement"
author: "Emmanel Pascual"
toc-title: Contents
toc: true
toc-depth: 2
date: "2023-03-21"
categories: 
image: "images/Data.jpg"
---


```{r, echo=FALSE, message=FALSE}
#load libraries
library(tidyverse)
library(readr)
amazon <- read_csv("amazon.csv")
View(amazon)

```

## 1. Number of reviews by year

The below histogram shows the number of video game reviews submitted to Amazon by year. From 1999 reviews largely increased year-on-year which is unsurprising given the growth of Amazon and access to the internet. The dataset shows the peak number of reviews was 2015 with a decline from 2016 to 2018. It is likely that this reflects the dataset being incomplete for recent years rather than the number of reviews declining in reality.

```{r, echo= FALSE}
#Get number of reviews per year
reviews_by_year <- amazon %>%
  group_by(year) %>%
  summarize(counts = n())

#ggplot(data = reviews_by_year, mapping = aes(x=year, y=counts))
#ggplot(reviews_by_year, aes(x=year, y=counts))

# plot
ggplot(data = reviews_by_year, mapping = aes(x=year, y=counts))+ # take the data frame, and map t with x as year and y as counts 
  geom_bar(stat= "identity",fill="white",color="black")+ 
  scale_x_continuous(breaks = 1999:2018)+
  theme(axis.text.x = element_text(angle = 85, vjust = 1, hjust=1))+
  xlab("")+
  ylab("")+
  scale_y_continuous(labels = scales::comma)+
  ggtitle("Number of reviews per year",
          subtitle = "1999 to 2018")+
  theme(
    panel.background = element_rect(fill = "lightgrey",
                                colour = "lightgrey",
                                linewidth = 0.5, linetype = "solid"),
    panel.grid.major=element_line(colour="black",linewidth = .05),
    panel.grid.minor=element_line(colour="lightgrey"))

```

## 2. Verified users

The dataset contains details of whether the review was based on a verified purchase. From [Amazon Community](https://www.amazon.co.uk/gp/help/customer/display.html?nodeId=G75XTB7MBMBTXP6W):

> An "Amazon Verified Purchase" review means that we've verified that the person writing the review purchased the product from Amazon, and didn't receive the product at a big discount. Reviews that are not marked "Amazon Verified Purchase" are valuable as well, but, either we cannot confirm that the product was purchased from Amazon, or that the customer paid a price that is available to most Amazon shoppers.

Table 1 shows the number of reviews based on verified and unverified purchases.

```{r, echo= FALSE}
#| label: tbl-verified
#| tbl-cap: Number of reviews by purchase status

#Get number of verified users
amazon
verified_reviews <- amazon %>%
  group_by(verified) %>%
  summarize(counts = n())

# print table
knitr::kable(verified_reviews)

```

Whilst the number of verified reviews is substantially larger than the number of unverified reviews, the below histogram demonstrates that this has not been a consistent trend and that the large increase in the number of reviews is largely driven by an increase in verified reviews.

```{r, echo= FALSE}
#Get number of reviews per year

year_by_verified_counts <- amazon %>%
  group_by(year,verified) %>%
  summarize(counts = n())


#ggplot(data = reviews_by_year, mapping = aes(x=year, y=counts))
#ggplot(reviews_by_year, aes(x=year, y=counts))

# plot
ggplot(data = year_by_verified_counts, 
       mapping = aes(x=year, 
                     y=counts, 
                     group = verified,
                     fill = verified))+
  geom_bar(stat= "identity")+
  scale_x_continuous(breaks = 1999:2018)+
  theme(axis.text.x = element_text(angle = 85, vjust = 1, hjust=1))+
  xlab("")+
  ylab("")+
  scale_y_continuous(labels = scales::comma)+
  ggtitle("Number of reviews per year",
          subtitle = "By purchase status")+
  theme(
    panel.background = element_rect(fill = "lightgrey",
                                colour = "lightgrey",
                                linewidth = 0.5, linetype = "solid"),
    panel.grid.major=element_line(colour="black",linewidth = .05),
    panel.grid.minor=element_line(colour="lightgrey"))

```

## 3. Review ratings

## 4. Overall

Amazon review ratings are provided on a scale of 1 (worst) to 5 (best) stars. The histogram below shows the total number of reviews assigned each rating.

```{r, echo= FALSE}
#Get number of reviews per each rating

reviews_by_rating <- amazon %>%
  group_by(rating) %>%
  summarize(counts = n())

#ggplot(data = reviews_by_year, mapping = aes(x=year, y=counts))
#ggplot(reviews_by_year, aes(x=year, y=counts))

# plot
ggplot(data = reviews_by_rating, mapping = aes(x=rating, y=counts))+
  geom_bar(stat= "identity",fill="white",color="black")+
  xlab("")+
  ylab("")+
  scale_y_continuous(labels = scales::comma)+
  ggtitle("Review Ratings",
          subtitle = "Number of reviews for each rating")+
  theme(
    panel.background = element_rect(fill = "lightgrey",
                                colour = "lightgrey",
                                linewidth = 0.5, linetype = "solid"),
    panel.grid.major=element_line(colour="black",linewidth = .05),
    panel.grid.minor=element_line(colour="lightgrey"))

```

## By purchase status

However, if you break this data down by verified purchases status you can see that whilst the number of verified and unverified reviews with 1 to 4 star reviews are similar, there is a very large number of 5 star reviews for verified purchases compared to unverified purchases.

```{r}
#Get number of reviews per year

rating_by_verified_counts <- amazon %>%
  group_by(rating,verified) %>%
  summarize(counts = n())

#ggplot(data = reviews_by_year, mapping = aes(x=year, y=counts))
#ggplot(reviews_by_year, aes(x=year, y=counts))

# plot
ggplot(data = rating_by_verified_counts, 
       mapping = aes(x=rating, 
                     y=counts, 
                     group = verified,
                     fill = verified))+

  geom_bar(stat= "identity", position = "dodge")+
  xlab("")+
  ylab("")+
  scale_y_continuous(labels = scales::comma)+
  ggtitle("Review Ratings",
          subtitle = "By purchase status")+
  theme(
    panel.background = element_rect(fill = "lightgrey",
                                colour = "lightgrey",
                                linewidth = 0.5, linetype = "solid"),
    panel.grid.major=element_line(colour="black",linewidth = .05),
    panel.grid.minor=element_line(colour="lightgrey"))

```

```{r}


verified_descriptions <- amazon %>% 
  group_by(verified) %>%
  summarize(`Mean rating` = round(mean(rating),digits= 2),
            `Median_rating` = median(rating)) %>%
  rename(Verified = verified)
 
  
#print table | Must match Verified Descriptions
knitr::kable(verified_descriptions)


```

```{r}
#Creating a table with Years, verified, and Mean Rating

year_rating_status <- amazon %>% 
  group_by(year, verified) %>%
  summarise(mean_rating = mean(rating), .groups = 'drop')

ggplot(data = year_rating_status, 
       mapping = aes(x=year, 
                     y=mean_rating, 
                     group = verified,
                     color = verified))+
  geom_line()+
  geom_point()+
  ylim(3.7 , 4.5)+
  scale_x_continuous(breaks = 1999:2018)+
  scale_color_manual(values = c('#1b9e77' , '#d95F02'))+
  theme(axis.text.x = element_text(angle = 85, vjust = 1, hjust=1))+
  xlab("Year")+
  ylab("Purchase Status")+
  ggtitle("Average Ratings",
          subtitle = "By Year & Purchase status")+
  theme(
    panel.background = element_rect(fill = "lightgrey",
                                colour = "lightgrey",
                                linewidth = 0.5, linetype = "solid"),
    panel.grid.major=element_line(colour="black",linewidth = .05),
    panel.grid.minor=element_line(colour="lightgrey"), 
    )
```
